CREATE TABLE USUARIO (
  id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
  nome VARCHAR2(100) NOT NULL,
  email VARCHAR2(150) UNIQUE NOT NULL,
  hash_senha VARCHAR2(256) NOT NULL,
  data_criacao TIMESTAMP DEFAULT SYSTIMESTAMP
);

CREATE TABLE TIPO_ATIVO (
  id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
  nome VARCHAR2(50) NOT NULL,
  descricao VARCHAR2(200)
);

CREATE TABLE ATIVO (
  id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
  codigo VARCHAR2(20) NOT NULL,
  nome VARCHAR2(100) NOT NULL,
  tipo_ativo_id NUMBER NOT NULL,
  mercado VARCHAR2(50),
  FOREIGN KEY (tipo_ativo_id) REFERENCES TIPO_ATIVO(id)
);

CREATE TABLE CARTEIRA (
  id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
  nome VARCHAR2(100) NOT NULL,
  descricao VARCHAR2(255),
  usuario_id NUMBER NOT NULL,
  data_criacao TIMESTAMP DEFAULT SYSTIMESTAMP,
  FOREIGN KEY (usuario_id) REFERENCES USUARIO(id)
);

CREATE TABLE CARTEIRA_ATIVO (
  id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
  carteira_id NUMBER NOT NULL,
  ativo_id NUMBER NOT NULL,
  quantidade NUMBER(18,6) DEFAULT 0,
  preco_medio NUMBER(18,6) DEFAULT 0,
  data_insercao TIMESTAMP DEFAULT SYSTIMESTAMP,
  FOREIGN KEY (carteira_id) REFERENCES CARTEIRA(id),
  FOREIGN KEY (ativo_id) REFERENCES ATIVO(id)
);

CREATE TABLE MOVIMENTACAO (
  id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
  carteira_id NUMBER NOT NULL,
  ativo_id NUMBER NOT NULL,
  tipo VARCHAR2(10) CHECK (tipo IN ('COMPRA','VENDA')),
  quantidade NUMBER(18,6),
  preco_unitario NUMBER(18,6),
  data_movimentacao TIMESTAMP DEFAULT SYSTIMESTAMP,
  FOREIGN KEY (carteira_id) REFERENCES CARTEIRA(id),
  FOREIGN KEY (ativo_id) REFERENCES ATIVO(id)
);

CREATE TABLE COTACAO (
  id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
  ativo_id NUMBER NOT NULL,
  data DATE NOT NULL,
  preco_abertura NUMBER(18,6),
  preco_maximo NUMBER(18,6),
  preco_minimo NUMBER(18,6),
  preco_fechamento NUMBER(18,6),
  volume NUMBER(18,2),
  FOREIGN KEY (ativo_id) REFERENCES ATIVO(id)
);